!function(a){"use strict";function f(a,b){a.style.WebkitTransform=b,a.style.msTransform=b,a.style.transform=b}function g(){var c=b.clientWidth,d=a.innerWidth;return c<d?d:c}function h(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function i(a,b){this.el=a,this.options=h({},this.options),h(this.options,b),this._init()}var b=a.document.documentElement,c={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},d=c[Modernizr.prefixed("transition")],e={transitions:Modernizr.csstransitions,support3d:Modernizr.csstransforms3d};i.prototype.options={},i.prototype._init=function(){this.grid=this.el.querySelector("section.grid-wrap > ul.grid"),this.gridItems=[].slice.call(this.grid.querySelectorAll("li:not(.grid-sizer)")),this.itemsCount=this.gridItems.length,this.slideshow=this.el.querySelector("section.slideshow > ul"),this.slideshowItems=[].slice.call(this.slideshow.children),this.current=-1,this.ctrlPrev=this.el.querySelector("section.slideshow > nav > span.nav-prev"),this.ctrlNext=this.el.querySelector("section.slideshow > nav > span.nav-next"),this.ctrlClose=this.el.querySelector("section.slideshow > nav > span.nav-close"),this._initMasonry(),this._initEvents()},i.prototype._initMasonry=function(){var a=this.grid;imagesLoaded(a,function(){new Masonry(a,{itemSelector:"li",columnWidth:a.querySelector(".grid-sizer")})})},i.prototype._initEvents=function(){var c=this;this.gridItems.forEach(function(a,b){a.addEventListener("click",function(){c._openSlideshow(b)})}),this.ctrlPrev.addEventListener("click",function(){c._navigate("prev")}),this.ctrlNext.addEventListener("click",function(){c._navigate("next")}),this.ctrlClose.addEventListener("click",function(){c._closeSlideshow()}),a.addEventListener("resize",function(){c._resizeHandler()}),document.addEventListener("keydown",function(a){if(c.isSlideshowVisible){var b=a.keyCode||a.which;switch(b){case 37:c._navigate("prev");break;case 39:c._navigate("next");break;case 27:c._closeSlideshow()}}}),a.addEventListener("scroll",function(){c.isSlideshowVisible?a.scrollTo(c.scrollPosition?c.scrollPosition.x:0,c.scrollPosition?c.scrollPosition.y:0):c.scrollPosition={x:a.pageXOffset||b.scrollLeft,y:a.pageYOffset||b.scrollTop}})},i.prototype._openSlideshow=function(a){if(this.isSlideshowVisible=!0,this.current=a,classie.addClass(this.el,"slideshow-open"),this._setViewportItems(),classie.addClass(this.currentItem,"current"),classie.addClass(this.currentItem,"show"),this.prevItem){classie.addClass(this.prevItem,"show");var b=Number(-1*(g()/2+this.prevItem.offsetWidth/2));f(this.prevItem,e.support3d?"translate3d("+b+"px, 0, -150px)":"translate("+b+"px)")}if(this.nextItem){classie.addClass(this.nextItem,"show");var b=Number(g()/2+this.nextItem.offsetWidth/2);f(this.nextItem,e.support3d?"translate3d("+b+"px, 0, -150px)":"translate("+b+"px)")}},i.prototype._navigate=function(a){if(!this.isAnimating){if("next"===a&&this.current===this.itemsCount-1||"prev"===a&&0===this.current)return void this._closeSlideshow();this.isAnimating=!0,this._setViewportItems();var k,l,m,b=this,c=this.currentItem.offsetWidth,h=e.support3d?"translate3d(-"+Number(g()/2+c/2)+"px, 0, -150px)":"translate(-"+Number(g()/2+c/2)+"px)",i=e.support3d?"translate3d("+Number(g()/2+c/2)+"px, 0, -150px)":"translate("+Number(g()/2+c/2)+"px)",j="";"next"===a?(k=e.support3d?"translate3d( -"+Number(2*g()/2+c/2)+"px, 0, -150px )":"translate(-"+Number(2*g()/2+c/2)+"px)",l=e.support3d?"translate3d( "+Number(2*g()/2+c/2)+"px, 0, -150px )":"translate("+Number(2*g()/2+c/2)+"px)"):(k=e.support3d?"translate3d( "+Number(2*g()/2+c/2)+"px, 0, -150px )":"translate("+Number(2*g()/2+c/2)+"px)",l=e.support3d?"translate3d( -"+Number(2*g()/2+c/2)+"px, 0, -150px )":"translate(-"+Number(2*g()/2+c/2)+"px)"),classie.removeClass(b.slideshow,"animatable"),("next"===a&&this.current<this.itemsCount-2||"prev"===a&&this.current>1)&&(m=this.slideshowItems["next"===a?this.current+2:this.current-2],f(m,l),classie.addClass(m,"show"));var n=function(){classie.addClass(b.slideshow,"animatable"),classie.removeClass(b.currentItem,"current");var c="next"===a?b.nextItem:b.prevItem;classie.addClass(c,"current"),f(b.currentItem,"next"===a?h:i),b.nextItem&&f(b.nextItem,"next"===a?j:k),b.prevItem&&f(b.prevItem,"next"===a?k:j),m&&f(m,"next"===a?i:h);var g=function(c){if(e.transitions){if(-1===c.propertyName.indexOf("transform"))return!1;this.removeEventListener(d,g)}b.prevItem&&"next"===a?classie.removeClass(b.prevItem,"show"):b.nextItem&&"prev"===a&&classie.removeClass(b.nextItem,"show"),"next"===a?(b.prevItem=b.currentItem,b.currentItem=b.nextItem,m&&(b.nextItem=m)):(b.nextItem=b.currentItem,b.currentItem=b.prevItem,m&&(b.prevItem=m)),b.current="next"===a?b.current+1:b.current-1,b.isAnimating=!1};e.transitions?b.currentItem.addEventListener(d,g):g()};setTimeout(n,25)}},i.prototype._closeSlideshow=function(){classie.removeClass(this.el,"slideshow-open"),classie.removeClass(this.slideshow,"animatable");var b=this,c=function(a){if(e.transitions){if("ul"!==a.target.tagName.toLowerCase())return;this.removeEventListener(d,c)}classie.removeClass(b.currentItem,"current"),classie.removeClass(b.currentItem,"show"),b.prevItem&&classie.removeClass(b.prevItem,"show"),b.nextItem&&classie.removeClass(b.nextItem,"show"),b.slideshowItems.forEach(function(a){f(a,"")}),b.isSlideshowVisible=!1};e.transitions?this.el.addEventListener(d,c):c()},i.prototype._setViewportItems=function(){this.currentItem=null,this.prevItem=null,this.nextItem=null,this.current>0&&(this.prevItem=this.slideshowItems[this.current-1]),this.current<this.itemsCount-1&&(this.nextItem=this.slideshowItems[this.current+1]),this.currentItem=this.slideshowItems[this.current]},i.prototype._resizeHandler=function(){function b(){a._resize(),a._resizeTimeout=null}var a=this;this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(b,50)},i.prototype._resize=function(){if(this.isSlideshowVisible){if(this.prevItem){var a=Number(-1*(g()/2+this.prevItem.offsetWidth/2));f(this.prevItem,e.support3d?"translate3d("+a+"px, 0, -150px)":"translate("+a+"px)")}if(this.nextItem){var a=Number(g()/2+this.nextItem.offsetWidth/2);f(this.nextItem,e.support3d?"translate3d("+a+"px, 0, -150px)":"translate("+a+"px)")}}},a.CBPGridGallery=i}(window);